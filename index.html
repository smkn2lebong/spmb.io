<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulir PPDB SMK</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e6f0ff;
      margin: 0;
      padding: 10px;
    }
    .card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px;
      max-width: 600px;
      margin: 20px auto;
      box-sizing: border-box;
    }
    .btn {
      background-color: #d71149;
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin-top: 15px;
      cursor: pointer;
      border-radius: 8px;
      font-size: 1rem;
      width: 100%;
      max-width: 250px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .btn:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .btn:hover:enabled {
      background-color: #b60f3a;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    h2 {
      color: #d71149;
      text-align: center;
    }
    h4 {
      margin-bottom: 5px;
      color: #d71149;
    }
    ul {
      padding-left: 20px;
    }
    @media (max-width: 400px) {
      .btn {
        padding: 12px 15px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

<div class="card" id="syarat">
  <h2>Syarat dan Ketentuan Pendaftaran</h2>
  <p><strong>Sebelum mengisi formulir, siapkan dokumen pendukung seperti:</strong></p>
  <ul>
    <li>Kartu Keluarga (KK)</li>
    <li>Ijazah atau Surat Keterangan Lulus (SKL)</li>
  </ul>
  <p>Pastikan Anda mengisi data dengan benar dan sesuai dokumen tersebut agar proses pendaftaran berjalan lancar.</p>
  <p>Setelah klik <strong>“Saya Setuju”</strong>, Anda akan melanjutkan ke Formulir Data Siswa. Pastikan setiap langkah diselesaikan dengan benar sebelum melanjutkan ke tahap berikutnya.</p>
  <div style="text-align: center;">
    <button class="btn" onclick="lanjutForm()">Saya Setuju</button>
  </div>
</div>

<form action="https://script.google.com/macros/s/AKfycbyg0ViGMFYazHB7JpTF4rY1nEh_ISbsVcoKP1WnGLOWSqixd_lDXFkWYxvYT2QqnFcV/exec" id="ppdbForm" method="POST" style="display:none;">
  <div class="card" id="form-siswa">
    <h2>Data Siswa</h2>
    <input id="nik" name="nik_siswa" maxlength="16" pattern="\d{16}" placeholder="NIK (16 digit)" required title="NIK harus 16 digit angka" type="text"/>
    <input id="kk" name="no_kk" maxlength="16" pattern="\d{16}" placeholder="Nomor KK (16 digit)" required title="Nomor KK harus 16 digit angka" type="text"/>
    <input id="nama" name="nama_siswa" placeholder="Nama Lengkap" required type="text"/>
    <input id="nisn" name="nisn" maxlength="10" pattern="\d{10}" placeholder="NISN (10 digit)" required title="NISN harus 10 digit angka" type="text"/>
    <select id="jk" name="jenis_kelamin" required>
      <option value="">Jenis Kelamin</option>
      <option value="Laki-laki">Laki-laki</option>
      <option value="Perempuan">Perempuan</option>
    </select>
    <input id="tempat_lahir" name="tempat_lahir" placeholder="Tempat Lahir" required type="text"/>
    <input id="tanggal_lahir" name="tanggal_lahir" required type="date"/>
    <select id="agama" name="agama" required>
      <option value="">Agama</option>
      <option value="Islam">Islam</option>
      <option value="Kristen">Kristen</option>
      <option value="Katolik">Katolik</option>
      <option value="Hindu">Hindu</option>
      <option value="Budha">Budha</option>
      <option value="Konghucu">Konghucu</option>
      <option value="Lainnya">Lainnya</option>
    </select>
    <textarea id="alamat" name="alamat_lengkap" placeholder="Alamat Lengkap" required></textarea>
    <input id="anak_ke" name="anak_ke" min="1" placeholder="Anak ke-" required type="number"/>
    <input id="jumlah_saudara" name="jumlah_saudara" min="0" placeholder="Jumlah Saudara Kandung" required type="number"/>
    <select id="status_keluarga" name="status_keluarga" required>
      <option value="">Status Dalam Keluarga</option>
      <option value="Anak Kandung">Anak Kandung</option>
      <option value="Anak Tiri">Anak Tiri</option>
      <option value="Anak Angkat">Anak Angkat</option>
    </select>
    <input id="sekolah_asal" name="sekolah_asal" placeholder="Nama Sekolah Asal" required type="text"/>
    <textarea id="alamat_sekolah" name="alamat_sekolah_asal" placeholder="Alamat Sekolah Asal" required></textarea>
    <input id="tahun_lulus" name="tahun_lulus" min="2020" max="2025" placeholder="Tahun Lulus" required type="number"/>
    <button class="btn" type="button" onclick="validasiSiswa()">Lanjut ke Data Periodik</button>
  </div>

  <div class="card" id="form-periodik" style="display:none;">
    <h2>Data Periodik</h2>
    <input id="tinggi" name="tinggi" placeholder="Tinggi Badan (cm)" required type="number"/>
    <input id="berat" name="berat" placeholder="Berat Badan (kg)" required type="number"/>
    <input id="jarak" name="jarak" placeholder="Jarak ke Sekolah (km)" required step="0.1" type="number"/>
    <input id="waktu" name="waktu" placeholder="Waktu Tempuh (menit)" required type="number"/>
    <select id="jurusan" name="pilihan_jurusan" required>
      <option value="">Pilih Jurusan</option>
      <option value="Tata Busana">Tata Busana</option>
      <option value="Teknik Instalasi Tenaga Listrik">Teknik Instalasi Tenaga Listrik</option>
    </select>
    <button class="btn" type="button" onclick="kembaliKeSiswa()">Kembali</button>
    <button class="btn" type="button" onclick="validasiPeriodik()">Lanjut ke Data Orang Tua</button>
  </div>

  <div class="card" id="form-ortu" style="display:none;">
    <h2>Data Orang Tua</h2>
    <h4>Ayah Kandung</h4>
    <input id="ayah_nama" name="nama_ayah" placeholder="Nama Ayah" required type="text"/>
    <input id="ayah_nik" name="nik_ayah" maxlength="16" pattern="\d{16}" placeholder="NIK Ayah (16 digit)" required title="NIK Ayah harus 16 digit angka" type="text"/>
    <input id="ayah_lahir" name="tahun_lahir_ayah" placeholder="Tahun Lahir Ayah" required type="number"/>
    <input id="ayah_pendidikan" name="pendidikan_ayah" placeholder="Pendidikan Ayah" required type="text"/>
    <input id="ayah_pekerjaan" name="pekerjaan_ayah" placeholder="Pekerjaan Ayah" required type="text"/>
    <input id="ayah_penghasilan" name="penghasilan_ayah" placeholder="Penghasilan Ayah" required type="text"/>
    <h4>Ibu Kandung</h4>
    <input id="ibu_nama" name="nama_ibu" placeholder="Nama Ibu" required type="text"/>
    <input id="ibu_nik" name="nik_ibu" maxlength="16" pattern="\d{16}" placeholder="NIK Ibu (16 digit)" required title="NIK Ibu harus 16 digit angka" type="text"/>
    <input id="ibu_lahir" name="tahun_lahir_ibu" placeholder="Tahun Lahir Ibu" required type="number"/>
    <input id="ibu_pendidikan" name="pendidikan_ibu" placeholder="Pendidikan Ibu" required type="text"/>
    <input id="ibu_pekerjaan" name="pekerjaan_ibu" placeholder="Pekerjaan Ibu" required type="text"/>
    <input id="ibu_penghasilan" name="penghasilan_ibu" placeholder="Penghasilan Ibu" required type="text"/>
    <button class="btn" type="button" onclick="kembaliKePeriodik()">Kembali</button>
    <button class="btn" type="button" onclick="validasiOrtu()">Lanjut ke Kontak</button>
  </div>

  <div class="card" id="form-kontak" style="display:none;">
    <h2>Kontak</h2>
    <input id="hp_siswa" name="hp_siswa" maxlength="15" pattern="\d{10,15}" placeholder="Nomor HP/WA Peserta Didik" required title="Masukkan nomor HP/WA yang valid" type="text"/>
    <input id="hp_ortu" name="hp_orangtua" maxlength="15" pattern="\d{10,15}" placeholder="Nomor HP/WA Orang Tua" required title="Masukkan nomor HP/WA yang valid" type="text"/>
    <button class="btn" type="button" onclick="kembaliKeOrtu()">Kembali</button>
    <button class="btn" type="submit" id="kirimBtn">Kirim Data</button>
  </div>
</form>

<div class="card" id="notifikasi" style="display:none; text-align:center;">
  <h2>Data Anda sudah terkirim!</h2>
  <p>Terima kasih telah mendaftar. Silakan download bukti pendaftaran Anda.</p>
  <button class="btn" onclick="window.location.reload()">Isi Formulir Baru</button>
</div>

<script>
  function lanjutForm() {
    document.getElementById('syarat').style.display = 'none';
    document.getElementById('ppdbForm').style.display = 'block';
  }

  function validasiSiswa() {
    const nik = document.getElementById('nik');
    if (!nik.checkValidity()) {
      alert(nik.title);
      nik.focus();
      return;
    }
    document.getElementById('form-siswa').style.display = 'none';
    document.getElementById('form-periodik').style.display = 'block';
  }

  function validasiPeriodik() {
    document.getElementById('form-periodik').style.display = 'none';
    document.getElementById('form-ortu').style.display = 'block';
  }

  function validasiOrtu() {
    document.getElementById('form-ortu').style.display = 'none';
    document.getElementById('form-kontak').style.display = 'block';
  }

  function kembaliKeSiswa() {
    document.getElementById('form-periodik').style.display = 'none';
    document.getElementById('form-siswa').style.display = 'block';
  }

  function kembaliKePeriodik() {
    document.getElementById('form-ortu').style.display = 'none';
    document.getElementById('form-periodik').style.display = 'block';
  }

  function kembaliKeOrtu() {
    document.getElementById('form-kontak').style.display = 'none';
    document.getElementById('form-ortu').style.display = 'block';
  }

  document.getElementById("ppdbForm").addEventListener("submit", async function(event) {
    event.preventDefault();
    const btn = document.getElementById("kirimBtn");
    btn.disabled = true;
    btn.innerText = "Mengirim silakan tunggu OK...";

    const form = event.target;
    const formData = new FormData(form);
    const encoded = new URLSearchParams(formData);

    try {
      const response = await fetch(form.action, {
        method: "POST",
        body: encoded
      });
      const result = await response.json();
      if (result.result === "success") {
        form.style.display = "none";
        document.getElementById("notifikasi").style.display = "block";
        window.open(result.pdfUrl, "_blank");
      } else {
        alert("Gagal menyimpan data: " + result.message);
      }
    } catch (err) {
      alert("Terjadi kesalahan: " + err.message);
    } finally {
      btn.disabled = false;
      btn.innerText = "Kirim Data";
    }
  });
</script>

</body>
</html>
